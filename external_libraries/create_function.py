import os

def create_function():
    header = open("/home/cali/Documents/tvm_ttile/tmp/ttile.h", "w")
    header.write("#ifndef _TTILE_H_\n")
    header.write("#define _TTILE_H_\n")
    header.write("extern void ttile_conv2d(float *, float *, float *, int, int, int, int, int, int);\n")
    header.write("#endif\n")
    header.close()

    cfile = open("/home/cali/Documents/tvm_ttile/tmp/ttile.c", "w")
    cfile.write("#include <stdio.h>\n")
    cfile.write("#include \"ttile.h\"\n")
    cfile.write("void ttile_conv2d(float* K, float * Input, float * Output, int W, int H, int C, int F, int X, int Y) {")
    cfile.write(" printf(\"newww functionnn\");\n")
    cfile.write(" for (int f=0; f<F; f++){\n")
    cfile.write("   for (int y=0; y<Y; y++){\n")
    cfile.write("     for (int x=0; x<X; x++){\n")
    cfile.write("       Output[f*Y*X + y*X + x] = 0.0;\n")
    cfile.write("       for (int c=0; c<C; c++){\n")
    cfile.write("         for (int h=0; h<H; h++){\n")
    cfile.write("           for (int w=0; w<W; w++){\n")
    cfile.write("             Output[f*Y*X + y*X + x] += Input[c*(Y+H-1)*(X+W-1) + (y+h)*(X+W-1) + x+w] * K[f * C*H*W + c * H*W + h*W + w];\n")
    cfile.write("           }\n")
    cfile.write("         }\n")
    cfile.write("       }\n")
    cfile.write("     }\n")
    cfile.write("    }\n")
    cfile.write("   }\n")
    cfile.write("   return;\n")
    cfile.write("}\n")
    cfile.close()

    os.system("gcc -o /home/cali/Documents/tvm_ttile/tmp/ttile.o -c /home/cali/Documents/tvm_ttile/tmp/ttile.c")
    os.system("gcc -shared -o /home/cali/Documents/tvm_ttile/tmp/libttile.so /home/cali/Documents/tvm_ttile/tmp/ttile.o -lm")
    os.system("sudo mv /home/cali/Documents/tvm_ttile/tmp/libttile.so /usr/lib/")